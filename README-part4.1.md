# üêß W≈Çasny obraz Live Debian + Custom Installer ‚Äì Cz.4.1: Prosty banner startowy z dynamicznym menu

W tej czƒô≈õci poka≈ºemy, jak dodaƒá do systemu konsolowego automatyczne wy≈õwietlanie spersonalizowanego bannera ASCII z logo "MojDebian", informacjami o systemie oraz interaktywne menu po starcie systemu.  
Banner wy≈õwietla dynamicznie odczytywany adres IP WebUI oraz oferuje podstawowe opcje systemowe.

---

## üìã Spis tre≈õci

1. [Wymagania](#1-wymagania)
2. [Konfiguracja projektu](#2-konfiguracja-projektu)
3. [Dodanie obs≈Çugi polskich znak√≥w](#3-dodanie-obs≈Çugi-polskich-znak√≥w)
4. [Tworzenie bannera z menu](#4-tworzenie-bannera-z-menu)
5. [Konfiguracja automatycznego uruchamiania](#5-konfiguracja-automatycznego-uruchamiania)
6. [Personalizacja systemu](#6-personalizacja-systemu)
7. [Budowanie obrazu ISO](#7-budowanie-obrazu-iso)
8. [Testowanie i rozwiƒÖzywanie problem√≥w](#8-testowanie-i-rozwiƒÖzywanie-problem√≥w)
9. [Struktura katalog√≥w](#9-struktura-katalog√≥w)
10. [Przydatne linki](#10-przydatne-linki)
11. [Autor i licencja](#11-autor-i-licencja)

---

> ‚ö†Ô∏è‚ùó**Uwaga!**  
> Ta czƒô≈õƒá bazuje na konfiguracji z czƒô≈õci 2 (wersja konsolowa). Upewnij siƒô, ≈ºe usunƒÖ≈Çe≈õ pakiety graficzne z `base.list.chroot`:
> ```
> # xfce4                # <- usu≈Ñ tƒô liniƒô
> # openbox              # <- usu≈Ñ tƒô liniƒô  
> # network-manager      # <- usu≈Ñ tƒô liniƒô
> ```

---

## 1. Wymagania

- System: Debian 12 (Bookworm)
- Uprawnienia sudo
- Po≈ÇƒÖczenie z internetem
- oko≈Ço 7GB wolnego miejsca na dysku
- Zako≈Ñczona konfiguracja z czƒô≈õci 2 (wersja konsolowa)

---

## 2. Konfiguracja projektu

Rozpocznij od oczyszczenia poprzedniego build i konfiguracji:

```bash
cd moj-debian
lb clean
sudo lb config -d bookworm --debian-installer live --archive-areas "main contrib non-free non-free-firmware" --debootstrap-options "--variant=minbase"
```

---

## 3. Dodanie obs≈Çugi polskich znak√≥w

### 3.1. Pakiety lokalizacji

Dodaj pakiety obs≈ÇugujƒÖce polskie znaki do listy pakiet√≥w:

```bash
nano config/package-lists/base.list.chroot
```

Dodaj na ko≈Ñcu pliku:

```
# Obs≈Çuga polskich znak√≥w
locales
console-setup
keyboard-configuration
procps
coreutils
util-linux
net-tools
```

**Obja≈õnienie pakiet√≥w:**
- `locales` - obs≈Çuga jƒôzyk√≥w i kodowa≈Ñ (UTF-8, polskie znaki)
- `console-setup` - konfiguracja konsoli (czcionki, klawiatura)  
- `keyboard-configuration` - ustawienia klawiatury (polskie znaki)
- `procps` - narzƒôdzia systemowe (`free`, `ps`, `top`, `uptime`)
- `coreutils` - podstawowe narzƒôdzia GNU (`ls`, `cat`, `grep`, `awk`)
- `util-linux` - narzƒôdzia systemowe (`mount`, `df`, `lsblk`)
- `net-tools` - narzƒôdzia sieciowe (`ifconfig`, `netstat`)

### 3.2. Konfiguracja locale

Utw√≥rz hook konfigurujƒÖcy polskie locale:

```bash
mkdir -p config/hooks/normal/
nano config/hooks/normal/configure-locale.chroot
```

Wklej:

```bash
#!/bin/sh
# Konfiguracja polskich locale

# Generuj locale pl_PL.UTF-8
echo "pl_PL.UTF-8 UTF-8" >> /etc/locale.gen
echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
locale-gen

# Ustaw domy≈õlne locale
echo "LANG=pl_PL.UTF-8" > /etc/default/locale
echo "LC_ALL=pl_PL.UTF-8" >> /etc/default/locale

# Konfiguracja konsoli dla polskich znak√≥w
echo "CHARMAP=UTF-8" > /etc/default/console-setup
echo "CODESET=guess" >> /etc/default/console-setup
echo "FONTFACE=Fixed" >> /etc/default/console-setup
echo "FONTSIZE=16" >> /etc/default/console-setup

# Konfiguracja klawiatury polskiej
echo "XKBMODEL=pc105" > /etc/default/keyboard
echo "XKBLAYOUT=pl" >> /etc/default/keyboard
echo "XKBVARIANT=" >> /etc/default/keyboard
echo "XKBOPTIONS=" >> /etc/default/keyboard

# Ustaw locale dla bie≈ºƒÖcej sesji
export LANG=pl_PL.UTF-8
export LC_ALL=pl_PL.UTF-8
```

Nadaj uprawnienia:

```bash
chmod +x config/hooks/normal/configure-locale.chroot
```

---

## 4. Tworzenie bannera z menu

### 4.1. Skrypt wy≈õwietlajƒÖcy banner

Najpierw utw√≥rz folder na skrypt:

```bash
mkdir -p config/includes.chroot/usr/local/bin
```

Nastƒôpnie utw√≥rz skrypt, kt√≥ry bƒôdzie wy≈õwietla≈Ç banner z logo i menu:

```bash
nano config/includes.chroot/usr/local/bin/startup-banner.sh
```

Wklej:

```bash
#!/bin/bash
# -*- coding: utf-8 -*-
# Ustawienie kodowania UTF-8 dla polskich znak√≥w
export LANG=pl_PL.UTF-8
export LC_ALL=pl_PL.UTF-8

# Funkcja pobierania IP z retry
get_ip_with_retry() {
    local max_attempts=10
    local delay=2
    local ip=""
    
    for i in $(seq 1 $max_attempts); do
        ip=$(ip route get 1.1.1.1 2>/dev/null | awk '/src/ {print $7}' 2>/dev/null)
        if [ -z "$ip" ]; then
            ip=$(ip addr show | grep 'inet ' | grep -v '127.0.0.1' | head -1 | awk '{print $2}' | cut -d'/' -f1 2>/dev/null)
        fi
        if [ -z "$ip" ]; then
            ip=$(hostname -I 2>/dev/null | awk '{print $1}')
        fi
        
        if [ -n "$ip" ] && [ "$ip" != "127.0.0.1" ]; then
            echo "$ip"
            return 0
        fi
        
        # Wy≈õwietl informacjƒô o pr√≥bie tylko przy pierwszym uruchomieniu
        if [ $i -eq 1 ]; then
            echo "Oczekiwanie na konfiguracjƒô sieci..." >&2
        fi
        
        sleep $delay
    done
    
    echo "brak po≈ÇƒÖczenia"
}

# Funkcja wy≈õwietlania bannera
show_banner() {
    clear
    
    # Pobierz aktualny adres IP z retry
    IP=$(get_ip_with_retry)
    
    # Wy≈õwietl banner
    echo -e "\e[36m"  # Kolor cyan
    cat << "EOF"
‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù
EOF
    echo -e "\e[0m"  # Reset koloru
    
    echo -e "\e[33mWersja: 1.0 - Twoja spersonalizowana dystrybucja Debian\e[0m"
    echo -e "\e[32mWebUI dostƒôpne pod adresem: http://${IP}:8080\e[0m"
    echo ""
    echo -e "\e[1;34m" # Bold niebieski    
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë               MENU                 ‚ïë"
    echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
    echo "‚ïë  1) Ustawienia                     ‚ïë"
    echo "‚ïë  2) Logowanie                      ‚ïë"
    echo "‚ïë  3) Wyj≈õcie                        ‚ïë"
    echo "‚ïë  4) Informacje o systemie          ‚ïë"
    echo "‚ïë  5) Status us≈Çug                   ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "\e[0m"
}

# Funkcja obs≈Çugi menu
handle_menu() {
    while true; do
        echo -n -e "\e[1;36mWybierz opcjƒô (1-5): \e[0m"
        read choice
        
        case $choice in
            1)
                echo -e "\e[33m=== USTAWIENIA SYSTEMU ===\e[0m"
                echo "1. Zmie≈Ñ has≈Ço u≈ºytkownika"
                echo "2. Konfiguracja sieci"
                echo "3. Restart us≈Çug"
                echo "4. Powr√≥t do menu g≈Ç√≥wnego"
                echo -n "Wybierz (1-4): "
                read sub_choice
                case $sub_choice in
                    1) passwd ;;
                    2) nmtui ;;
                    3) 
                        echo "Restartowanie us≈Çug..."
                        systemctl restart mywebui.service
                        echo "Us≈Çugi zosta≈Çy zrestartowane."
                        ;;
                    4) show_banner; handle_menu; return ;;
                esac
                ;;
            2)
                echo -e "\e[32mPrzechodzenie do logowania...\e[0m"
                break
                ;;            
            3)
                echo -e "\e[31mZamykanie systemu...\e[0m"
                sudo shutdown -h now
                ;;
            4)
                echo -e "\e[33m=== INFORMACJE O SYSTEMIE ===\e[0m"
                echo "Hostname: $(hostname)"                
                # Sprawd≈∫ dostƒôpno≈õƒá komend systemowych
                if command -v uptime >/dev/null 2>&1; then
                    echo "Czas dzia≈Çania: $(uptime -p 2>/dev/null || uptime | cut -d',' -f1 | cut -d' ' -f3-)"
                else
                    echo "Czas dzia≈Çania: $(cat /proc/uptime | cut -d' ' -f1 | awk '{printf "%.0f sekund", $1}')"
                fi
                
                if command -v free >/dev/null 2>&1; then
                    echo "U≈ºycie pamiƒôci: $(free -h | grep Mem | awk '{print $3"/"$2}' 2>/dev/null || echo 'Niedostƒôpne')"
                else
                    # Alternatywna metoda bez free - u≈ºywa /proc/meminfo
                    echo "U≈ºycie pamiƒôci: $(awk '
                        /MemTotal/ { total = $2 }
                        /MemFree/ { free = $2 }
                        /Buffers/ { buffers = $2 }
                        /Cached/ { cached = $2 }
                        END { 
                            if (total > 0) {
                                used = total - free - buffers - cached
                                printf "%.1fMB/%.1fMB", used/1024, total/1024
                            } else {
                                print "Niedostƒôpne"
                            }
                        }' /proc/meminfo)"
                fi
                
                if command -v df >/dev/null 2>&1; then
                    echo "U≈ºycie dysku: $(df -h / 2>/dev/null | tail -1 | awk '{print $3"/"$2" ("$5")"}' || echo 'Niedostƒôpne')"
                else
                    echo "U≈ºycie dysku: Niedostƒôpne"
                fi
                
                if command -v systemctl >/dev/null 2>&1; then
                    echo "Aktywne us≈Çugi: $(systemctl list-units --type=service --state=running 2>/dev/null | wc -l || echo 'Niedostƒôpne')"
                else
                    echo "Aktywne us≈Çugi: Niedostƒôpne"
                fi
                echo ""
                echo "Naci≈õnij Enter aby kontynuowaƒá..."
                read
                show_banner
                ;;
            5)
                echo -e "\e[33m=== STATUS US≈ÅUG ===\e[0m"
                echo "WebUI Service:"
                systemctl status mywebui.service --no-pager -l
                echo ""
                echo "Network Manager:"
                systemctl status NetworkManager --no-pager -l
                echo ""
                echo "Naci≈õnij Enter aby kontynuowaƒá..."
                read
                show_banner
                ;;
            *)
                echo -e "\e[31mNieprawid≈Çowa opcja! Wybierz 1-5.\e[0m"
                ;;
        esac
    done
}

# G≈Ç√≥wna funkcja
main() {
    show_banner
    handle_menu
}

# Uruchom tylko je≈õli skrypt jest wykonywany bezpo≈õrednio
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main
fi
```

### 4.2. Nadanie uprawnie≈Ñ

```bash
chmod +x config/includes.chroot/usr/local/bin/startup-banner.sh
```

---

## 5. Konfiguracja automatycznego uruchamiania

### 5.1. Us≈Çuga systemd

Utw√≥rz us≈Çugƒô, kt√≥ra bƒôdzie uruchamia≈Ça banner przy starcie:

```bash
nano config/includes.chroot/etc/systemd/system/startup-banner.service
```

Wklej:

```
[Unit]
Description=Startup Banner with Menu
After=network-online.target mywebui.service
Wants=network-online.target
Requires=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/startup-banner.sh
StandardInput=tty
StandardOutput=tty
TTYPath=/dev/tty1
RemainAfterExit=yes
User=root

[Install]
WantedBy=multi-user.target
```

### 5.2. Hook aktywujƒÖcy us≈Çugƒô

```bash
nano config/hooks/normal/enable-startup-banner.chroot
```

Wklej:

```bash
#!/bin/sh
systemctl enable startup-banner.service

# Wy≈ÇƒÖcz getty na tty1 aby nie kolidowa≈Ço
systemctl disable getty@tty1.service
```

Nadaj uprawnienia:

```bash
chmod +x config/hooks/normal/enable-startup-banner.chroot
```

---

## 6. Personalizacja systemu

### 6.1. Konfiguracja informacji o systemie

```bash
nano config/includes.chroot/etc/os-release
```

Wklej:

```
PRETTY_NAME="MojDebian GNU/Linux"
NAME="MojDebian"
VERSION_ID="1.0"
VERSION="1.0 (Custom)"
ID=mojdebian
ID_LIKE=debian
HOME_URL="https://github.com/SebastianSebastianB/my-debian-live-webui"
SUPPORT_URL="https://github.com/SebastianSebastianB/my-debian-live-webui/issues"
BUG_REPORT_URL="https://github.com/SebastianSebastianB/my-debian-live-webui/issues"
```

### 6.2. Banner konsoli (plik issue)

```bash
nano config/includes.chroot/etc/issue
```

Wklej:

```
MojDebian GNU/Linux \r \l

‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù

Wersja: 1.0 - Twoja spersonalizowana dystrybucja Debian
Dla dostƒôpu do WebUI sprawd≈∫ adres IP: ip a

```

---

> üí° **Wskaz√≥wka:**  
> Plik `/etc/issue` wy≈õwietla siƒô podczas logowania w konsoli (TTY) PRZED podaniem nazwy u≈ºytkownika i has≈Ça.  
> Zmienne `\r` i `\l` automatycznie wy≈õwietlajƒÖ wersjƒô jƒÖdra i nazwƒô terminala.

---

### 6.3. Dynamiczne aktualizowanie adresu IP w issue

Aby automatycznie aktualizowaƒá adres IP w bannerze, utw√≥rz skrypt:

```bash
nano config/includes.chroot/usr/local/bin/update-issue.sh
```

Wklej:

```bash
#!/bin/bash
# Skrypt aktualizujƒÖcy /etc/issue z aktualnym IP

# Funkcja pobierania IP z retry
get_ip_with_retry() {
    local max_attempts=5
    local delay=1
    local ip=""
    
    for i in $(seq 1 $max_attempts); do
        ip=$(ip route get 1.1.1.1 2>/dev/null | awk '/src/ {print $7}' 2>/dev/null)
        if [ -z "$ip" ]; then
            ip=$(ip addr show | grep 'inet ' | grep -v '127.0.0.1' | head -1 | awk '{print $2}' | cut -d'/' -f1 2>/dev/null)
        fi
        if [ -z "$ip" ]; then
            ip=$(hostname -I 2>/dev/null | awk '{print $1}')
        fi
        
        if [ -n "$ip" ] && [ "$ip" != "127.0.0.1" ]; then
            echo "$ip"
            return 0
        fi
        
        sleep $delay
    done
    
    echo "brak IP"
}

# Pobierz adres IP z retry
IP=$(get_ip_with_retry)

# Aktualizuj /etc/issue
cat > /etc/issue << EOF
MojDebian GNU/Linux \\r \\l

‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù

Wersja: 1.0 - Twoja spersonalizowana dystrybucja Debian
WebUI dostƒôpne pod adresem: http://${IP}:8080

EOF
```

### 6.4. Us≈Çuga aktualizujƒÖca IP

```bash
nano config/includes.chroot/etc/systemd/system/update-issue.service
```

Wklej:

```
[Unit]
Description=Update issue with current IP
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/update-issue.sh

[Install]
WantedBy=multi-user.target
```

### 6.5. Hook aktywujƒÖcy aktualizacjƒô IP

```bash
nano config/hooks/normal/enable-update-issue.chroot
```

Wklej:

```bash
#!/bin/sh
chmod +x /usr/local/bin/update-issue.sh
systemctl enable update-issue.service
```

Nadaj uprawnienia:

```bash
chmod +x config/hooks/normal/enable-update-issue.chroot
```

---

## 7. Budowanie obrazu ISO

Aby zbudowaƒá w≈Çasny obraz ISO Debiana z przygotowanƒÖ konfiguracjƒÖ, uruchom poni≈ºsze polecenie w katalogu projektu:

```bash
sudo lb build
```

Proces budowania mo≈ºe potrwaƒá od kilku do kilkudziesiƒôciu minut w zale≈ºno≈õci od wydajno≈õci komputera oraz szybko≈õci ≈ÇƒÖcza internetowego.

Po zako≈Ñczeniu w katalogu projektu pojawi siƒô plik `.iso` (np. `live-image-amd64.hybrid.iso`).  
Ten plik mo≈ºesz:

- **Uruchomiƒá w maszynie wirtualnej** (np. VirtualBox, QEMU, VMware)
- **Nagraƒá na pendrive** (np. za pomocƒÖ balenaEtcher, Rufus, dd) i uruchomiƒá na fizycznym komputerze
- **Zainstalowaƒá system** na dysku lub u≈ºywaƒá w trybie Live

---

### Efekt ko≈Ñcowy

Po uruchomieniu systemu:

1. **Podczas logowania** - wy≈õwietla siƒô banner z `/etc/issue` z aktualnym IP
2. **Po zalogowaniu** - automatycznie uruchamia siƒô kolorowy banner z interaktywnym menu
3. **Menu oferuje**:
   - Ustawienia systemu (zmiana has≈Ça, konfiguracja sieci, restart us≈Çug)
   - Przej≈õcie do normalnej pow≈Çoki (Login)
   - Wy≈ÇƒÖczenie systemu (Exit)
   - Informacje o systemie (u≈ºycie pamiƒôci, dysku, uptime)
   - Status us≈Çug (WebUI, NetworkManager)

---

## 8. Testowanie i rozwiƒÖzywanie problem√≥w

### 8.1. Testowanie w maszynie wirtualnej

Najlepszym sposobem testowania jest u≈ºycie VirtualBox lub QEMU:

**VirtualBox:**
```bash
# Utw√≥rz nowƒÖ maszynƒô wirtualnƒÖ
# Wybierz: Type: Linux, Version: Debian (64-bit)
# RAM: minimum 1GB (zalecane 2GB)
# Uruchom z utworzonego pliku ISO
```

**QEMU (szybkie testowanie):**
```bash
qemu-system-x86_64 -cdrom live-image-amd64.hybrid.iso -m 2048 -boot d
```

### 8.2. Typowe problemy i rozwiƒÖzania

**Problem: IP wy≈õwietla "brak po≈ÇƒÖczenia" przy starcie**
```bash
# Sprawd≈∫ czy sieƒá jest aktywna
ip addr show

# Sprawd≈∫ status us≈Çug sieciowych
systemctl status NetworkManager
systemctl status networking

# Sprawd≈∫ zale≈ºno≈õci us≈Çugi
systemctl list-dependencies startup-banner.service

# Uruchom banner rƒôcznie po starcie systemu
/usr/local/bin/startup-banner.sh
```

**Problem: Banner nie wy≈õwietla siƒô automatycznie**
```bash
# Sprawd≈∫ status us≈Çugi
systemctl status startup-banner.service

# Sprawd≈∫ logi
journalctl -u startup-banner.service

# Uruchom rƒôcznie
/usr/local/bin/startup-banner.sh
```

**Problem: Polskie znaki nie wy≈õwietlajƒÖ siƒô poprawnie**
```bash
# Sprawd≈∫ locale
locale

# Sprawd≈∫ konfiguracjƒô konsoli
cat /etc/default/console-setup
cat /etc/default/keyboard

# Prze≈Çaduj konfiguracjƒô
setupcon
```

**Problem: WebUI nie dzia≈Ça**
```bash
# Sprawd≈∫ status us≈Çugi
systemctl status mywebui.service

# Sprawd≈∫ port
netstat -tlnp | grep :8080

# Sprawd≈∫ logi
journalctl -u mywebui.service
```

**Problem: Brak komend systemowych (uptime, free)**
- Upewnij siƒô, ≈ºe pakiety `procps`, `coreutils`, `util-linux` sƒÖ w `base.list.chroot`
- Skrypt automatycznie u≈ºywa alternatywnych metod je≈õli komendy nie sƒÖ dostƒôpne

**Problem: U≈ºycie pamiƒôci wy≈õwietla "Niedostƒôpne" lub nieprawid≈Çowe warto≈õci**
```bash
# Sprawd≈∫ dostƒôpno≈õƒá komend pamiƒôci
command -v free && echo "free dostƒôpne" || echo "free niedostƒôpne"

# Sprawd≈∫ dostƒôpno≈õƒá /proc/meminfo
cat /proc/meminfo | head -10

# Testuj rƒôcznie kod alternatywny
awk '
    /MemTotal/ { total = $2 }
    /MemFree/ { free = $2 }
    /Buffers/ { buffers = $2 }
    /Cached/ { cached = $2 }
    END { 
        if (total > 0) {
            used = total - free - buffers - cached
            printf "%.1fMB/%.1fMB", used/1024, total/1024
        } else {
            print "Niedostƒôpne"
        }
    }' /proc/meminfo

# Sprawd≈∫ czy pakiet procps jest zainstalowany
dpkg -l | grep procps
```

**Wyja≈õnienie obs≈Çugi pamiƒôci:**
- Skrypt u≈ºywa `free -h` jako pierwszƒÖ opcjƒô (naj≈Çatwiejsza do odczytu)
- Je≈õli `free` nie jest dostƒôpne, u≈ºywa alternatywnej metody z `/proc/meminfo`
- Alternatywna metoda oblicza u≈ºytƒÖ pamiƒôƒá jako: `MemTotal - MemFree - Buffers - Cached`
- W systemach Live (RAM-disk) wy≈õwietlane sƒÖ warto≈õci u≈ºycia pamiƒôci RAM

### 8.3. Debugowanie skryptu bannera

Aby debugowaƒá skrypt, dodaj na poczƒÖtku:
```bash
#!/bin/bash
set -x  # W≈ÇƒÖcz tryb debug
# reszta skryptu...
```

### 8.4. Rƒôczne uruchomienie

Je≈õli automatyczne uruchamianie nie dzia≈Ça:
```bash
# Uruchom banner rƒôcznie
sudo /usr/local/bin/startup-banner.sh

# Lub dodaj do ~/.bashrc u≈ºytkownika
echo "/usr/local/bin/startup-banner.sh" >> ~/.bashrc
```

---

## 9. Struktura katalog√≥w

```
moj-debian-part4.1/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ includes.chroot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usr/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ local/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ bin/
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ startup-banner.sh
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ update-issue.sh
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ etc/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ systemd/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ system/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ startup-banner.service
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ update-issue.service
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ os-release
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ issue
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ opt/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ mywebui/
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ app.py
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îÇ 
‚îÇ   ‚îú‚îÄ‚îÄ package-lists/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.list.chroot
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ python.list.chroot
‚îÇ   ‚îÇ 
‚îÇ   ‚îî‚îÄ‚îÄ hooks/
‚îÇ       ‚îî‚îÄ‚îÄ normal/
‚îÇ           ‚îú‚îÄ‚îÄ install-webui.chroot
‚îÇ           ‚îú‚îÄ‚îÄ enable-mywebui.chroot
‚îÇ           ‚îú‚îÄ‚îÄ enable-startup-banner.chroot
‚îÇ           ‚îî‚îÄ‚îÄ enable-update-issue.chroot
```

---

## 10. Przydatne linki

- [systemd.service ‚Äì dokumentacja](https://www.freedesktop.org/software/systemd/man/systemd.service.html)
- [TTY i getty w systemd](https://wiki.archlinux.org/title/Getty)
- [Bash scripting ‚Äì kolorowanie tekstu](https://misc.flogisoft.com/bash/tip_colors_and_formatting)
- [live-build lb_config ‚Äì dokumentacja konfiguracji](https://manpages.debian.org/unstable/live-build/lb_config.1.en.html)
- [Oficjalna dokumentacja Debian Live Systems](https://wiki.debian.org/DebianLive)

---

## 11. Autor i licencja

- Autor: [Sebastian Bartel](https://github.com/SebastianSebastianB)
- E-mail: umbraos@icloud.com
- Licencja: MIT

---
